<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div style="padding: 20px; font-family: Arial, sans-serif;">
        <h1>ğŸ§ª Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
        <button id="testConnection" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <div id="result" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; min-height: 50px;"></div>
        
        <div style="margin-top: 30px;">
            <h3>ğŸ“ í…Œì´ë¸” ìƒì„±</h3>
            <button id="createTable" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">locations í…Œì´ë¸” ìƒì„±</button>
        </div>
        
        <div style="margin-top: 30px;">
            <h3>â• í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€</h3>
            <button id="addTestData" style="padding: 10px 20px; background: #ffc107; color: black; border: none; border-radius: 5px; cursor: pointer;">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€</button>
        </div>
    </div>

    <script>
        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://yciqltvaqlnxavfwysqv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljaXFsdHZhcWxueGF2Znd5c2d2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MTQ5NDYsImV4cCI6MjA3Mjk5MDk0Nn0.5W5MDiz4YzzzB-IpfiGgsFgexj2W1FTbKu7-sOYKWtw';

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const resultDiv = document.getElementById('result');

        // ì—°ê²° í…ŒìŠ¤íŠ¸
        document.getElementById('testConnection').addEventListener('click', async () => {
            try {
                resultDiv.innerHTML = 'ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';
                
                // ê°„ë‹¨í•œ ì¿¼ë¦¬ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
                const { data, error } = await supabaseClient
                    .from('_supabase_sessions')  // ê¸°ë³¸ í…Œì´ë¸”ë¡œ í…ŒìŠ¤íŠ¸
                    .select('count', { count: 'exact', head: true });

                if (error && error.code !== 'PGRST116') { // PGRST116ì€ í…Œì´ë¸”ì´ ì—†ìŒì„ ì˜ë¯¸ (ì •ìƒ)
                    throw error;
                }
                
                resultDiv.innerHTML = `
                    <div style="color: green;">
                        âœ… Supabase ì—°ê²° ì„±ê³µ!<br>
                        ğŸ“ URL: ${SUPABASE_URL}<br>
                        ğŸ”‘ API Key: ${SUPABASE_ANON_KEY.substring(0, 50)}...
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="color: red;">
                        âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}<br>
                        ìƒì„¸: ${JSON.stringify(error, null, 2)}
                    </div>
                `;
            }
        });

        // í…Œì´ë¸” ìƒì„±
        document.getElementById('createTable').addEventListener('click', async () => {
            try {
                resultDiv.innerHTML = 'ğŸ”„ í…Œì´ë¸” ìƒì„± ì¤‘...';
                
                // SQLë¡œ í…Œì´ë¸” ìƒì„± ì‹œë„
                const { data, error } = await supabaseClient.rpc('exec_sql', {
                    query: `
                        CREATE TABLE IF NOT EXISTS locations (
                            id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                            name VARCHAR(255) NOT NULL,
                            address TEXT NOT NULL,
                            latitude DECIMAL(10, 8),
                            longitude DECIMAL(11, 8),
                            category VARCHAR(50) NOT NULL,
                            rating INTEGER CHECK (rating >= 1 AND rating <= 5),
                            visit_date DATE NOT NULL,
                            memo TEXT,
                            photos JSONB DEFAULT '[]'::jsonb,
                            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
                        );
                    `
                });

                if (error) {
                    throw error;
                }
                
                resultDiv.innerHTML = `
                    <div style="color: green;">
                        âœ… locations í…Œì´ë¸” ìƒì„± ì™„ë£Œ!
                    </div>
                `;
            } catch (error) {
                // RPCê°€ ì—†ë‹¤ë©´ ë‹¤ë¥¸ ë°©ë²• ì‹œë„
                resultDiv.innerHTML = `
                    <div style="color: orange;">
                        âš ï¸ RPCë¥¼ í†µí•œ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: ${error.message}<br>
                        ğŸ’¡ Supabase ëŒ€ì‹œë³´ë“œì—ì„œ SQL ì—ë””í„°ë¡œ ì§ì ‘ ì‹¤í–‰í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }
        });

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
        document.getElementById('addTestData').addEventListener('click', async () => {
            try {
                resultDiv.innerHTML = 'ğŸ”„ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì¤‘...';
                
                const testData = {
                    name: 'ìŠ¤íƒ€ë²…ìŠ¤ ê°•ë‚¨ì ',
                    address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 152',
                    latitude: 37.5012767,
                    longitude: 127.0396597,
                    category: 'cafe',
                    rating: 4,
                    visit_date: '2024-01-15',
                    memo: 'ë¶„ìœ„ê¸° ì¢‹ê³  Wi-Fi ë¹¨ë¼ìš” â˜•'
                };

                const { data, error } = await supabaseClient
                    .from('locations')
                    .insert([testData])
                    .select();

                if (error) {
                    throw error;
                }
                
                resultDiv.innerHTML = `
                    <div style="color: green;">
                        âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì™„ë£Œ!<br>
                        ğŸ“Š ì¶”ê°€ëœ ë°ì´í„°: ${JSON.stringify(data[0], null, 2)}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="color: red;">
                        âŒ ë°ì´í„° ì¶”ê°€ ì‹¤íŒ¨: ${error.message}<br>
                        ìƒì„¸: ${JSON.stringify(error, null, 2)}
                    </div>
                `;
            }
        });

        // ìë™ìœ¼ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        document.getElementById('testConnection').click();
    </script>
</body>
</html>